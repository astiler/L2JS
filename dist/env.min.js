/*! L2JS v0.0.2 | Copyright 2014, 2014 Tomáš Konrády (tomas.konrady@uhk.cz). | MIT licence */
!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a):function(a){if(!a.document)throw new Error("l2js requires a window with a document");return b(a)}:b(a)}(this,function(window){var _l2js=window.l2js;window.l2js=window.l2js||(window.l2js={}),window.l2js.files={},l2js.core=l2js.core||{},l2js.core.Promise=function a(b){this.deferred=b},l2js.core.Promise.prototype.then=function(a,b){return this.deferred.successCallback=a,this.deferred.errorCallback=b,this.result=l2js.core.q.deferred(),this.result.promise},l2js.core.Promise.prototype.catch=function(a){this.deferred.errorCallback=a},l2js.core.Deferred=function(){this.promise=new l2js.core.Promise(this)},l2js.core.Deferred.prototype.reject=function(a){this.errorCallback&&this.promise.result.reject(this.errorCallback(a)||a)},l2js.core.Deferred.prototype.resolve=function(a){this.successCallback&&this.promise.result.resolve(this.successCallback(a)||a)},l2js.core.q={deferred:function(){return new l2js.core.Deferred}},l2js.utils={copy:function(a){if(l2js.utils.isUndefined(a)||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)b[c]=l2js.utils.copy(a[c]);return b},hasProp:{}.hasOwnProperty,extend:function(a,b){for(var c in b)l2js.utils.hasProp.call(b,c)&&(a[c]=b[c]);function d(){this.constructor=a}return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},indexOf:function(a,b,c){c||(c=0);var d=a.length;for(0>c&&(c=d+c);d>c;c++)if(a[c]===b)return c;return-1},isUndefined:function(a){return"undefined"==typeof a},isFunction:function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},toUpperFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},padLeft:function(a,b,c){while(a.length<c)a=b+a;return a}},l2js.compiler=l2js.compiler||{},l2js.compiler.env=l2js.compiler.env||{},l2js.compiler.env.Alphabet=function(){function a(a,b){this.id=a,this.symbols=b}return a.prototype.hasSymbol=function(a){return this.symbols||a?this.symbols&&a&&-1!==l2js.utils.indexOf(this.symbols,a):!1},a}(),l2js.compiler.env.SubLSystem=function(){function a(a,b,c,d){this.ctx=a,this.lsystem=b,"number"==typeof c&&(maxIteration=c,c=void 0),this.axiom=c,this.maxIterations=d}return a.prototype.derive=function(){var a;return this.lsystemInst||(this.lsystemInst=new this.lsystem(this.ctx)),this.derivation?a=this.lsystemInst.derive(this.derivation,this.maxIterations):(a=this.lsystemInst.derive(this.axiom,this.maxIterations),this.axiom=a.axiom),this.derivation=a.derivation,this.interpretation=a.interpretation,this},a}(),l2js.compiler.env.Stack=function(){function a(a,b,c){this.start=a,this.end=b,this.string=c}return a}(),l2js.compiler.env.LSystem=function(a){function b(b){this.ctx=b?a.utils.copy(b):{},this.rulesProbabilities={}}return b.prototype.checkAlphabetSymbol=function(a){},b.prototype.derive=function(b,c){0===arguments.length?(b=this.axiom(),c=this.maxIterations):1===arguments.length?"number"==typeof b?(c=arguments[0],b=this.axiom()):c=this.maxIterations:2===arguments.length&&(b=b||this.axiom(),c=a.utils.isUndefined(c)?this.maxIterations:c);var d,e=c+1,f={axiom:b,totalIterations:c,derivations:[],interpretations:[]};for(d=0;e>d;d++)f.derivation=f.derivation?this.deriveString(f.derivation,"-"):b,f.interpretation=this.deriveString(f.derivation,"h"),f.derivations.push(a.utils.copy(f.derivation)),f.interpretations.push(a.utils.copy(f.interpretation));return f},b.prototype.deriveString=function(b,c){var d=[],e;for(e=0;e<b.length;e++){if(a.utils.isUndefined(b[e]))throw Error("Undefined ancestor.");if(b[e]instanceof a.compiler.env.SubLSystem)"-"===c&&d.push(a.utils.copy(b[e]).derive())||d.push(a.utils.copy(b[e]));else if(b[e]instanceof a.compiler.env.Stack)d.push(new a.compiler.env.Stack(b[e].start,b[e].end,this.deriveString(b[e].string,c)));else{var f=b[e];this.checkAlphabetSymbol(f.symbol),d=d.concat(this.findDerivation(f,c))}}return d},b.prototype.findDerivation=function(c,d){var e=b.makeHash(c,d);if(!a.utils.isUndefined(this.rules[e])){var f=this.rules[e];if(a.utils.isUndefined(this.rulesProbabilities[e]))for(this.rulesProbabilities[e]=0,i=0;i<f.length;i++){var g=f[i];this.rulesProbabilities[e]+=g.probability}if(0!==this.rulesProbabilities[e]){var h=Math.random()*this.rulesProbabilities[e],i,j=0;for(i=0;i<f.length;i++){var g=f[i];if(j+=g.probability,j>=h)return g.successor.apply(this,c.arguments)}}}return[c]},b.makeHash=function(b,c){var d=b.arguments||b.params||[],e="";a.utils.isUndefined(c)&&(c="-");var f;for(f=0;f<d.length;f++)e+=a.utils.isUndefined(d[f])?0:1;return c+"@"+e+"_"+b.symbol},b.getModule=function(a,b,c){return{alphabet:c,symbol:a,arguments:b}},b.getParamModule=function(a,b,c){return{alphabet:c,symbol:a,params:b}},b.id="",b.alphabet={},b}(l2js),l2js.compiler.env.LScript=function(){function a(a){this.ctx=l2js.utils.copy(a)}return a.prototype.derive=function(a,b){var c=new this.main(this.ctx),d=c.derive(a||this.axiom,b||this.maxIterations);return d},a}(),l2js.compiler.env.SubLScript=function(){function SubLScript(a,b,c){this.lscript=a,this.axiom=b,this.maxIterations=c}return SubLScript.prototype.derive=function(){var deferred=l2js.core.q.deferred();return setTimeout(function(){try{var out=eval(lsystemCode);deferred.resolve(out)}catch(err){deferred.reject(err)}},0),deferred.promise;var result},SubLScript}()});
//# sourceMappingURL=dist/l2js.min.map